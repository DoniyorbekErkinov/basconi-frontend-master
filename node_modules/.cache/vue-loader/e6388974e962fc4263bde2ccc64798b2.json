{"remainingRequest":"P:\\noenter\\basconi-frontend-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!P:\\noenter\\basconi-frontend-master\\src\\modules\\post\\post\\index.vue?vue&type=style&index=0&id=624853be&scoped=true&lang=css&","dependencies":[{"path":"P:\\noenter\\basconi-frontend-master\\src\\modules\\post\\post\\index.vue","mtime":1652787130000},{"path":"P:\\noenter\\basconi-frontend-master\\node_modules\\css-loader\\dist\\cjs.js","mtime":1695882312813},{"path":"P:\\noenter\\basconi-frontend-master\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1695882545754},{"path":"P:\\noenter\\basconi-frontend-master\\node_modules\\postcss-loader\\src\\index.js","mtime":1695882308750},{"path":"P:\\noenter\\basconi-frontend-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1695882313197},{"path":"P:\\noenter\\basconi-frontend-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1695882545643}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5zbWFsbCB7CiAgZm9udC1zaXplOiAxMHB4OwogIHJpZ2h0OiAtMTgwcHg7CiAgdG9wOiAtMTBweDsKfQouZGVza3RvcCB7CiAgZm9udC1zaXplOiAxMHB4OwogIHJpZ2h0OiAtMzgwcHg7CiAgdG9wOiAtMTJweDsKfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAk4BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/modules/post/post","sourcesContent":["<template>\n  <div>\n    {{itemsLength}}\n    <q-toolbar>\n      {{getDepartmentName}}\n      <q-fab style=\"z-index: 1000; right: 18px; top: -15px; font-size: 16px\" padding=\"xs\" color=\"secondary\" glossy icon=\"keyboard_arrow_down\" direction=\"down\">\n        <q-fab-action style=\"z-index: 999; margin-top: -8px\" color=\"primary\" padding=\"xs\" text-color=\"white\" icon=\"mdi-lightning-bolt-circle\" @click=\"openPendingModal\"/>\n        <q-fab-action @click=\"CloseZmodal = true\" padding=\"xs\" style=\"z-index: 999; font-size: 16px; font-weight: 600; padding-left: 7px; padding-right: 7px; margin-top: -3px\" color=\"accent\" text-color=\"white\" >Z</q-fab-action>\n      </q-fab>\n      <q-toolbar-title style=\"font-size: 18px; height: 55px; color: #030385\"><b>{{ userInfo.name }}</b> -\n        <b>{{  lol.name }}</b>\n      </q-toolbar-title>\n    </q-toolbar>\n    <q-btn @click=\"makePayment\" round icon=\"shopping_cart\" class=\"q-ml-md fixed bg-blue-grey-13 text-white\" style=\"z-index: 1000; right: 18px; top: 190px; font-size: 18px\">\n      <q-badge style=\"margin-top: 5px; \" align=\"middle\" color=\"red\" floating>{{ totalItems  }}</q-badge>\n    </q-btn>\n    <q-separator/>\n    <vs-row justify=\"center\">\n      <vs-col w=\"12\" class=\"mt-1\">\n        <vs-input state=\"primary\" block icon-after class=\"q-mr-lg\" v-model=\"search\" :placeholder=\"$t('actions.search')\">\n          <template #icon>\n            <q-icon name=\"search\"/>\n          </template>\n        </vs-input>\n      </vs-col>\n    </vs-row>\n    <div class=\"row\">\n      <div class=\"mt-1\" :class=\"windowWidth < 600 ? 'col-4' : 'col-2'\" v-for=\"(con, ind) in productList\" :key=\"`productList-${ind}`\">\n        <q-card @click=\"getItemDescription(con)\" class=\"no-padding q-mx-xs\"\n                :class=\" saleform.whItems.findIndex((e) => e.id == con.id) > -1 ? 'bg-green-12' : 'bg-light-blue-3'\"\n                 style=\"margin: 2px 2px\" align=\"left\">\n          <q-badge style=\"width: 85px; left: -5px;  top: -5px;\" rounded  color=\"red-6\" floating>{{ con.price }}: {{$t('uzb_currency')}}</q-badge>\n          <q-card-section v-if=\"windowWidth < 600\">\n<!--            <div>{{ con.itemName }}</div>-->\n            <div>{{ con.itemCku }}</div>\n            <div>{{ con.colorName }}</div>\n            <div>{{ con.sizeOlcham }} / {{ con.remaining }}</div>\n          </q-card-section>\n          <q-card-section v-else class=\"pl-1\">\n            <div style=\"display: flex; justify-content: space-between\">\n              <div style=\"text-align: left\"><b>{{ $t('items.brand') }}:</b> <span\n                  class=\"text-pink-6\">{{ con.brandName }}</span></div>\n              <div style=\"text-align: left\"><b>{{ $t('items.sku') }}:</b> <span\n                  class=\"text-pink-6\">{{ con.itemCku }}</span></div>\n            </div>\n            <q-separator/>\n            <div style=\"display: flex; justify-content: space-between\">\n              <div style=\"text-align: left\"><b>{{ $t('items.count') }}:</b> <span\n                  class=\"text-pink-6\">{{ con.remaining }}</span></div>\n              <div style=\"text-align: left\"><b>{{ $t('items.size') }}:</b> <span\n                  class=\"text-pink-6\">{{ con.sizeOlcham }}</span></div>\n            </div>\n            <q-separator/>\n            <div style=\"display: flex; justify-content: space-between\">\n              <div style=\"text-align: left\"><b>{{ $t('items.colors') }}:</b> <span\n                  class=\"text-pink-6\">{{ con.colorName }}</span></div>\n<!--              <div style=\"text-align: left\"><b>{{ $t('items.brand') }}:</b> <span\n                  class=\"text-pink-6\">{{ con.brandName }}</span></div>-->\n            </div>\n          </q-card-section>\n        </q-card>\n      </div>\n    </div>\n    <vs-row justify=\"center\">\n      <vs-col w=\"6\" justify=\"center\">\n        <vs-button block :disabled=\"totalList < 20\" @click=\"getMore\" primary gradient>Load More</vs-button>\n      </vs-col>\n    </vs-row>\n    <!-- Modal For Get Item By Id -->\n    <vs-dialog v-model=\"itemModel\" blur style=\"margin-bottom: 105px\" width=\"100%\" @close=\"makeEmpty\">\n      <q-toolbar>\n        <q-toolbar-title>{{ $t('references.reference_product') }}</q-toolbar-title>\n      </q-toolbar>\n      <div class=\"no-padding no-margin\">\n        <q-card class=\"no-padding mb-1\">\n          <q-card-section class=\"pl-1\">\n            <div style=\"display: flex; justify-content: space-between\">\n              <div style=\"text-align: left\"><b>{{ $t('items.brand') }}:</b> <span\n                  class=\"text-pink-6\">{{ productInfo.brandName }}</span></div>\n              <div style=\"text-align: left\"><b>{{ $t('items.sku') }}:</b> <span\n                  class=\"text-pink-6\">{{ productInfo.itemCku }}</span></div>\n            </div>\n            <q-separator/>\n            <div style=\"display: flex; justify-content: space-between\">\n              <div style=\"text-align: left\"><b>{{ $t('items.count') }}:</b> <span\n                  class=\"text-pink-6\">{{ productInfo.remaining }}</span></div>\n              <div style=\"text-align: left\"><b>{{ $t('items.size') }}:</b> <span\n                  class=\"text-pink-6\">{{ productInfo.sizeOlcham }}</span></div>\n            </div>\n            <q-separator/>\n            <div style=\"display: flex; justify-content: space-between\">\n              <div style=\"text-align: left\"><b>{{ $t('items.colors') }}:</b> <span\n                  class=\"text-pink-6\">{{ productInfo.colorName }}</span></div>\n              <!--<div style=\"text-align: left\"><b>{{ $t('items.brand') }}:</b> <span\n                  class=\"text-pink-6\">{{ productInfo.brandName }}</span></div>-->\n            </div>\n            <q-separator/>\n            <div class=\"mt-1\" style=\"text-align: left\">\n              <b>{{ $t('items.price') }}:</b>\n              <span class=\"text-pink-6 mt-1 ml-1\" style=\"font-size: 16px;\">{{productInfo.price }}</span>\n            </div>\n          </q-card-section>\n        </q-card>\n      </div>\n      <vs-row class=\"mt-2\">\n        <vs-col w=\"6\">\n          <vs-input type=\"number\" state=\"primary\" block v-model=\"dynamicItem.salePrice\"/>\n        </vs-col>\n        <vs-col w=\"6\">\n          <q-btn-group>\n            <q-btn padding=\"xs\" @click=\"dynamicItem.count > 0 ? dynamicItem.count-- : null\" color=\"green\"\n                   icon=\"arrow_left\"/>\n            <q-btn >{{ dynamicItem.count }}</q-btn>\n            <q-btn :disable=\"dynamicItem.count === productInfo.remaining\" padding=\"xs\"\n                   @click=\"dynamicItem.count >= 0 ? dynamicItem.count++ : null\" color=\"green\" icon=\"arrow_right\"/>\n          </q-btn-group>\n        </vs-col>\n        <vs-row justify=\"center\">\n          <vs-col class=\"mt-1\" w=\"8\">\n            <vs-button @click=\"addSaleList\" block color=\"success\" style=\"font-size: 12px; font-weight: 400; letter-spacing: 1px;\">\n              <i class=\"mdi mdi-cart-plus mr-1\"/> {{ $t('post.add') }}\n            </vs-button>\n          </vs-col>\n        </vs-row>\n      </vs-row>\n    </vs-dialog>\n<!--     Z-Modal -->\n    <vs-dialog v-model=\"Zmodal\" blur prevent-close @close=\"goHome\" width=\"60%\">\n      <q-toolbar>\n        <q-toolbar-title>{{ $t('post.z-report') }} / {{ $t('doc.code') }}: {{ zCode }}</q-toolbar-title>\n      </q-toolbar>\n      <q-separator/>\n      <vs-row justify=\"center\">\n        <vs-input block class=\"mt-1\" state=\"primary\" v-model=\"code\"/>\n        <vs-col :w=\"windowWidth < 600 ? '6' : '2'\" class=\"mt-1\">\n          <vs-button class=\"ml-3\" @click=\"closeZcode\">{{ $t('actions.save') }}</vs-button>\n        </vs-col>\n      </vs-row>\n    </vs-dialog>\n<!--     Close Z-Modal   -->\n    <vs-dialog v-model=\"CloseZmodal\" blur prevent-close @close=\"getItemsByDepId\" width=\"100%\">\n      <q-toolbar>\n        <q-toolbar-title>\n          {{$t('post.close-z')}}\n        </q-toolbar-title>\n      </q-toolbar>\n      <vs-row justify=\"space-around\" width=\"100%\">\n        <vs-col w=\"5\">\n          <vs-button @click=\"closeZReport\" block success gradient>{{$t('actions.yes')}}</vs-button>\n        </vs-col>\n        <vs-col w=\"5\">\n          <vs-button @click=\"CloseZmodal = false\" block danger gradient>{{$t('actions.no')}}</vs-button>\n        </vs-col>\n      </vs-row>\n    </vs-dialog>\n<!--    To'lov-->\n    <vs-dialog v-model=\"payment\"  blur prevent-close width=\"100%\">\n      <q-toolbar>\n        <vs-row>\n          <vs-col w=\"1\">\n            <vs-button style=\"top: -8px\" flat icon danger @click=\"clear\">\n              <q-icon name=\"delete\"/>\n            </vs-button>\n          </vs-col>\n          <vs-col w=\"11\">\n            <q-toolbar-title>{{ $t('post.payment') }}</q-toolbar-title>\n          </vs-col>\n        </vs-row>\n      </q-toolbar>\n      <vs-row>\n        <vs-col class=\"mb-1\">\n          <q-toolbar-title>\n            {{ calculateTotal }}: {{ calculate }} So'm\n          </q-toolbar-title>\n        </vs-col>\n      </vs-row>\n      <div>\n        <q-card  class=\"no-padding mb-1\" v-for=\"(item, i) in saleform.whItems\" :key=\"item.id\">\n          <q-btn\n            :class=\"windowWidth < 600 ? 'small' : 'desktop'\"\n            round\n            color=\"negative\"\n            size=\"sm\"\n            icon=\"close\"\n            @click=\"deleteDynamicItem(i)\"\n          ></q-btn>\n          <q-card-section vertical class=\"pl-1\">\n            <div style=\"display: flex; justify-content: space-between\">\n              <div style=\"text-align: left\"><b>{{ $t('items.brand') }}:</b> <span\n                  class=\"text-pink-6\">{{ item.brandName }}</span></div>\n              <div style=\"text-align: left\"><b>{{ $t('items.sku') }}:</b> <span\n                  class=\"text-pink-6\">{{ item.itemCku }}</span></div>\n            </div>\n            <q-separator/>\n            <div style=\"display: flex; justify-content: space-between;\" class=\"mt-1 mb-1\">\n              <div style=\"text-align: left\"><b>{{ $t('items.count') }}:</b>\n                <q-btn-group style=\"padding: 2px;\" class=\"ml-1\">\n                  <q-btn padding=\"xs\" @click=\"item.count > 0 ? item.count-- : null\" color=\"green\"\n                         icon=\"arrow_left\"/>\n                  <q-btn >{{ item.count }}</q-btn>\n                  <q-btn :disable=\"item.count === productInfo.remaining\" padding=\"xs\"\n                         @click=\"item.count >= 0 ? item.count++ : null\" color=\"green\" icon=\"arrow_right\"/>\n                </q-btn-group>\n              </div>\n              <div style=\"text-align: left\"><b>{{ $t('items.size') }}:</b> <span\n                  class=\"text-pink-6\">{{ item.sizeOlcham }}</span></div>\n            </div>\n            <q-separator/>\n            <div style=\"display: flex; justify-content: space-between\">\n              <div style=\"text-align: left\"><b>{{ $t('items.colors') }}:</b> <span\n                  class=\"text-pink-6\">{{ item.colorName }}</span></div>\n              <!--<div style=\"text-align: left\"><b>{{ $t('items.brand') }}:</b> <span\n                  class=\"text-pink-6\">{{ item.brandName }}</span></div>-->\n            </div>\n            <q-separator/>\n            <div style=\"text-align: center\">\n              <b>{{ $t('post.sold_price') }}:</b>\n              <span class=\"text-pink-6 mt-1\" style=\"font-size: 16px;\">{{item.salePrice }}</span>\n            </div>\n          </q-card-section>\n        </q-card>\n      </div>\n      <template #footer>\n        <div style=\"display: flex; justify-content: center; flex-direction: column\">\n          <div v-for=\"(payment, i) in paymentList\" :key=\"i\">\n            <div style=\"display: flex; justify-content: center; flex-direction: row;\" class=\"mt-1\">\n              <vs-button @click=\"calculatePrice(payment, i)\">{{payment.name}}</vs-button>\n              <input :id=\"`price-${i}`\" state=\"primary\" v-model=\"paymentList[i].amount\" :key=\"i\" class=\"vs-input a\"/>\n            </div>\n          </div>\n        </div>\n        <vs-row>\n          <vs-col :w=\"windowWidth > 600 ? '6' : '12'\">\n            <vs-button @click=\"save('READY')\" :class=\"windowWidth > 600 ? 'mt-1 mr-1' : 'mt-1'\" block success gradient>{{ $t('post.payment') }}</vs-button>\n          </vs-col>\n          <vs-col :w=\"windowWidth > 600 ? '6' : '12'\">\n            <vs-button  @click=\"save('SUSPENDED')\" :class=\"windowWidth > 600 ? 'mt-1 mr-1' : ''\" block warn gradient>{{ $t('actions.save') }}</vs-button>\n          </vs-col>\n        </vs-row>\n      </template>\n    </vs-dialog>\n    <!--  Pending Modal  -->\n    <vs-dialog v-model=\"pendingModal\"  blur prevent-close :width=\"windowWidth > 600 ? '100%' : '60%'\">\n      <q-toolbar>\n        <vs-row>\n          <vs-col w=\"12\">\n            <q-toolbar-title>{{ $t('post.payment') }}</q-toolbar-title>\n          </vs-col>\n        </vs-row>\n      </q-toolbar>\n      <q-separator/>\n      <div class=\"row\">\n        <div class=\"col-10 mt-1\" style=\"margin: 0 auto\">\n          <q-expansion-item v-for=\"item in saleList\" :key=\"item.id\" :label=\"item.regNumber\" style=\"border-radius: 15px\" header-class=\"bg-primary text-white\" expand-icon-class=\"text-white\" class=\"shadow-1 overflow-hidden mt-1\">\n            <q-card class=\"mb-1 bg-grey-2\">\n              <q-card-section>\n                <div style=\"text-align: left\">\n                  <b>{{ $t('doc.regDate') }}: </b>\n                  <span class=\"text-pink-6 ml-2\">{{ item.regDate }}</span>\n                </div>\n                <div style=\"text-align: left\" >\n                  <b >{{ $t('doc.regNumber') }}:</b>\n                  <span style=\"text-align: right; margin-left: 3px\" class=\"text-pink-6\">{{ item.regNumber }}</span>\n                </div>\n                <q-card class=\"q-pa-sm mb-1 \" v-for=\"(subItem, i) in item.whDocItems\" :key=\"`subItem-${i}`\">\n                  <div style=\"text-align: left\">\n                    <b>{{ $t('items.sku') }}: </b>\n                    <span class=\"text-pink-6 ml-2\">{{ subItem.cku }}</span>\n                  </div>\n                  <div style=\"text-align: left\">\n                    <b>{{ $t('items.size') }}: </b>\n                    <span class=\"text-pink-6\">{{ subItem.sizeOlcham }}</span>\n                  </div>\n                  <div style=\"text-align: left\">\n                    <b>{{ $t('items.count') }}: </b>\n                    <span class=\"text-pink-6 ml-2\">{{ subItem.count }}</span>\n                  </div>\n                  <div style=\"text-align: left\">\n                    <b>{{ $t('post.sold_price') }}:</b>\n                    <span class=\"text-pink-6 ml-2\">{{ subItem.salePrice }}</span>\n                  </div>\n                </q-card>\n              </q-card-section>\n              <q-card-actions>\n                <div class=\"row\" style=\"justify-content: space-between; margin: 0 auto\">\n                  <div class=\"col-5\">\n                    <vs-button  @click=\"editSale(item.id)\"  block primary gradient>\n                      <q-icon name=\"edit\"/>\n                    </vs-button>\n                  </div>\n                  <div class=\"col-5\">\n                    <vs-button  @click=\"openDeleteModal(item.id)\"block danger gradient>\n                      <q-icon name=\"delete\"/>\n                    </vs-button>\n                  </div>\n                </div>\n              </q-card-actions>\n            </q-card>\n          </q-expansion-item>\n        </div>\n      </div>\n    </vs-dialog>\n    <!--          BeforePos          -->\n    <vs-dialog v-model=\"beforePostModal\" @close=\"goHome\"  blur prevent-close :width=\"windowWidth > 600 ? '100%' : '60%'\">\n      <q-toolbar>\n        <q-toolbar-title>\n          {{$t('post.start_sale')}}\n        </q-toolbar-title>\n      </q-toolbar>\n      <vs-select\n        block\n        class=\"mt-3\"\n        @change=\"getCashBoxById($event)\"\n        v-model=\"depId1\"\n        :key=\"`depList-${depList.length}`\"\n        :label=\"$t('doc.department')\"\n      >\n        <vs-option v-for=\"dep in depList\" :key=\"dep.id\" :value=\"dep.id\" :label=\"dep.name\">\n          {{dep.name}}\n        </vs-option>\n      </vs-select>\n      <vs-select\n          block\n          class=\"mt-3\"\n          v-model=\"beforePostForm.cashBoxId\"\n          :key=\"`${cashBox.length}`\"\n          :label=\"$t('management.cash_box_name')\"\n      >\n        <vs-option v-for=\"cash in cashBox\" :key=\"cash.id\" :value=\"cash.id\" :label=\"cash.name\">\n          {{cash.name}}\n        </vs-option>\n      </vs-select>\n      <vs-row justify=\"center\">\n        <vs-col w=\"6\" class=\"mt-3\">\n          <vs-button block @click=\"setBeforePostIdsToLocale\">\n            {{$t('post.go_pos')}}\n          </vs-button>\n        </vs-col>\n      </vs-row>\n    </vs-dialog>\n    <!--       Delete       -->\n    <confirm-modal :model=\"deleteModal\" @submit=\"deleteSaleDoc\" @close=\"deleteModal = false\" :text=\"$t('confirm_delete')\"/>\n  </div>\n</template>\n<script>\nimport {TokenService} from \"../../../services/storage.service\";\nimport UsersService from \"../../management/users/users.service\";\nimport DepartmentService from \"../../management/department/department.service\";\nimport WareHaseService from \"../../wms/warehouse/warehouse.service\";\nimport SaleService from \"./sale.service\";\nimport ConfirmModal from \"../../../components/confirmModal\"\nimport CashBoxService from \"../../references/cashbox/cashbox.service\";\nimport ZReportService from \"./z-report.service\";\nimport PaymentService from \"../../references/payment/payment.service\";\nexport default {\n  name: \"index\",\n  data() {\n    return {\n      windowWidth: window.innerWidth,\n      userInfo: {},\n      saleList: [],\n      totalList: 0,\n      search1: '',\n      depList: [],\n      productList: [],\n      productInfo: {},\n      pagination: {\n        page: 1,\n        limit: 20\n      },\n      payload: {\n        page: 1,\n        limit: 20\n      },\n      totalItems: 0,\n      depId: '',\n      selected: '',\n      search: '',\n      itemId: '',\n      dynamicItem: {\n        count: 1,\n        salePrice: 0\n      },\n      saleform: {\n        cashboxId: null,\n        cashboxName: \"\",\n        comment: \"\",\n        contragentId: null,\n        contragentName: \"\",\n        fromDepartmentId: null,\n        fromDepartmentName: \"\",\n        regDate: \"\",\n        regNumber: \"\",\n        status: \"ACTIVE\",\n        toDepartmentId: null,\n        zetReportId: null,\n        toDepartmentName: \"\",\n        paymentTypeId: null,\n        ammount: 0,\n        totolCount: 0,\n        whItems:[],\n        paymentDtos: []\n      },\n      paymentDtos: {\n        ammount: 0,\n        id: 0,\n        paymentTypeId: 0,\n        paymentTypeName: \"\",\n        totolCount: 0\n      },\n      Zmodal: false,\n      CloseZmodal: false,\n      payment: false,\n      code: null,\n      zCode: 123,\n      itemsTotal: 0,\n      itemModel: false,\n      totalPorducts: 0,\n      totalSum: 0,\n      pendingModal: false,\n      docId: null,\n      suspendedList: [],\n      deleteModal: false,\n      beforePostModal: false,\n      beforePostForm: {\n        departmentId: '',\n        cashBoxId: ''\n      },\n      cashBox: [],\n      lol: {},\n      zForm: {\n        id: null,\n        cashboxId: null,\n        cashboxName: \"\",\n        departmentId: null,\n        departmentName: \"\",\n        end: \"\",\n        open: true,\n        start: \"\"\n      },\n      close_Z_Form: {\n        id: null,\n        cashboxId: null,\n        cashboxName: \"\",\n        departmentId: null,\n        departmentName: \"\",\n        end: \"\",\n        start: \"\"\n      },\n      checkedZetId: null,\n      paymentList: [],\n      depId1: '',\n      paymentAmount: ''\n    }\n  },\n  components: {\n    ConfirmModal\n  },\n  computed: {\n    calculate() {\n      return this.saleform.whItems.reduce((total, item) => {\n        return this.saleform.ammount = total + item.count * item.salePrice\n      }, 0)\n    },\n    calculateTotal() {\n      return  this.saleform.whItems.reduce((total, item) => {\n        return this.saleform.totolCount = total + item.count\n      }, 0)\n    },\n    itemsLength() {\n      this.totalItems = this.saleform.whItems.length\n    },\n    getDepartmentName() {\n      this.depList.forEach(dep => {\n        if(dep.id == TokenService.getDepartmentId()){\n          return this.lol = dep\n        }\n      })\n    },\n  },\n  watch: {\n    'search': {\n      handler(e) {\n        this.getItemsByDepId();\n      }\n    },\n    'paymentList': {\n      handler(e) {\n      },\n      deep: true\n    }\n  },\n  methods: {\n    getCashBoxById(depId1){\n      this.GetCashBoxList(depId1);\n    },\n    calculatePrice(payment, index) {\n      let sum = 0\n      this.paymentList.forEach(pay => {\n        pay.amount = parseFloat(pay.amount);\n        if (pay.amount)\n          sum += pay.amount\n      })\n      payment.amount = this.calculate - sum;\n      this.paymentAmount = payment.amount\n      this.$set(this.paymentList, index, payment);\n    },\n    getPaymentList() {\n      PaymentService.getPaymentList().then(res => {\n        this.paymentList = res.data\n        this.paymentList.forEach(pay => {\n          pay.amount = 0\n        })\n      })\n    },\n    getMore() {\n      this.pagination.page = this.pagination.page +1\n      this.depId = TokenService.getDepartmentId()\n      let list = {}\n      WareHaseService.getItemByDepIdAndSearch(this.depId, this.search, this.pagination).then(res => {\n        list = res.data.list\n        this.totalList = res.data.total\n        this.productList = Object.assign(this.productList.concat(list))\n      })\n    },\n    getCurrentUser() {\n      let user = TokenService.getUserInfo()\n      UsersService.getUsersById(user.id).then(res => {\n        this.userInfo = res.data\n      })\n    },\n    getItemsByDepId() {\n      this.depId = localStorage.getItem('dep_id')\n      WareHaseService.getItemByDepIdAndSearch(this.depId, this.search, this.pagination).then(res => {\n        this.productList = res.data.list\n        this.totalList = res.data.total\n      })\n    },\n    getSaleSuspended() {\n      let getSusForm = {}\n      getSusForm.cashboxId = localStorage.getItem('cashboxId')\n      getSusForm.departmentId = localStorage.getItem('dep_id')\n      SaleService.getSaleSuspendedList(getSusForm).then(res => {\n        this.saleList = res.data\n      }).catch(e => {\n        this.$vs.notification({\n          duration: 1000,\n          title: e.message,\n          progress: 'auto',\n          color: 'danger',\n          position: 'top-right'\n        })\n      })\n    },\n    openPendingModal() {\n      this.pendingModal = true\n    },\n    async makePayment() {\n      await this.getPaymentList()\n      this.payment = true\n    },\n    addSaleList() {\n      if (this.dynamicItem.count > 0) {\n        if (this.itemId) {\n          let has = false,\n              ind = 0\n          this.saleform.whItems.forEach((whItem, index) => {\n            if (whItem.id === this.dynamicItem.id) {\n              if (whItem.remaining >= this.dynamicItem.count) {\n                has = true\n                ind = index\n              }\n            }\n          })\n          if (has) {\n            this.saleform.whItems.splice(ind, 1)\n            this.dynamicItem = {}\n            this.itemId = ''\n            this.itemModel = false\n            this.color = true\n          }\n          this.dynamicItem.salePrice =  +this.dynamicItem.salePrice\n          let item = Object.assign({}, this.dynamicItem)\n          if (item.remaining >= this.dynamicItem.count) {\n            this.saleform.whItems.unshift(item)\n            this.itemsTotal = this.saleform.whItems.length\n            this.itemModel = false\n            this.itemId = ''\n            this.dynamicItem.count = null\n            this.dynamicItem.salePrice = null\n          } else {\n            this.$vs.notification({\n              // title: this.$t('big-count'),\n              title: 'Item Id',\n              progress: 'auto',\n              duration: 1000,\n              color: 'danger',\n              position: 'top-right'\n            })\n          }\n        } else {\n          this.$vs.notification({\n            // title: this.$t('big-count'),\n            title: 'Item Id',\n            progress: 'auto',\n            duration: 1000,\n            color: 'danger',\n            position: 'top-right'\n          })\n        }\n      } else {\n        this.$vs.notification({\n          // title: this.$t('big-count'),\n          title: 'Son kiritilmagan',\n          progress: 'auto',\n          duration: 1000,\n          color: 'danger',\n          position: 'top-right'\n        })\n      }\n    },\n    deleteDynamicItem(index) {\n      this.saleform.whItems.splice(index, 1)\n      this.itemsTotal--\n    },\n    createSaleForm() {\n      if (!this.Zmodal) {\n      SaleService.CreateEmptyDoc().then(res => {\n        this.saleform = {\n          whItems: [\n            {salePrice: null}\n          ]\n        }\n        this.saleform = res.data\n        this.saleform.fromDepartmentId = this.userInfo.departmentId\n        this.dynamicItem = {}\n        this.saleform.whItems = []\n        this.getItemsByDepId()\n        this.getSaleSuspended()\n      }).catch(e => {\n        this.$vs.notification({\n          title: e.message,\n          duration: 1000,\n          progress: 'auto',\n          color: 'danger',\n          position: 'top-right'\n        })\n      })\n      }\n    },\n    getItemDescription(con) {\n      this.productInfo = con\n      this.dynamicItem = this.productInfo\n      this.itemId = con.id\n      this.productInfo.count = 1\n      this.productInfo.salePrice = con.price\n      this.itemModel = true\n    },\n    makeEmpty() {\n      this.dynamicItem = {}\n      this.itemId = ''\n      this.dynamicItem.count = null\n      this.dynamicItem.salePrice = null\n    },\n    editSale(id) {\n      this.docId = id\n      SaleService.getSaleListById(this.docId).then(res => {\n        this.dynamicItem = {}\n        this.itemId = ''\n        this.saleform = {\n          ...res.data,\n          salePrice: res.data.whDocItems.salePrice,\n          whItems: res.data.whDocItems,\n          whDocItems: null\n        }\n        this.payment = true\n      }).catch(e => {\n        this.$vs.notification({\n          title: e.message,\n          duration: 1000,\n          progress: 'auto',\n          color: 'danger',\n          position: 'top-right'\n        })\n      })\n    },\n    openDeleteModal(id) {\n      this.docId = null\n      this.docId = id\n      this.deleteModal = true\n    },\n    deleteSaleDoc() {\n      SaleService.deleteSaleDoc(this.docId).then(res => {\n        this.getSaleSuspended();\n        this.getItemsByDepId();\n        this.pendingModal = false\n        this.deleteModal = false\n        this.$vs.notification({\n          duration: 1000,\n          title: this.$t('success_deleted'),\n          progress: 'auto',\n          color: 'success',\n          position: 'top-right'\n        })\n      }).catch(e => {\n        this.$vs.notification({\n          title: e.message,\n          duration: 1000,\n          progress: 'auto',\n          color: 'danger',\n          position: 'top-right'\n        })\n      })\n    },\n    clear() {\n      this.saleform.whItems = []\n      this.totalPorducts = 0\n      this.totalSum = 0\n      this.payment = false\n      this.itemsTotal = null\n    },\n    BeforePost() {\n      if(localStorage.getItem('cashboxId') === null && localStorage.getItem('dep_id') === null){\n        this.beforePostModal = true\n        this.checkZReport()\n        this.GetDepartmentList()\n        this.GetCashBoxList()\n      } else {\n        this.createSaleForm()\n        this.beforePostModal = false\n      }\n    },\n    goHome() {\n      this.$router.push({name: 'Dashboard'})\n    },\n    GetDepartmentList() {\n      DepartmentService.getDepByAccess().then(res => {\n        this.depList = res.data || []\n      })\n    },\n    GetCashBoxList() {\n      CashBoxService.getByDebId(this.depId1).then(res => {\n        this.cashBox = res.data || []\n      })\n    },\n    setBeforePostIdsToLocale() {\n      this.beforePostForm.departmentId = this.depId1\n      if(this.beforePostForm.cashBoxId && this.beforePostForm.departmentId) {\n        TokenService.saveCashBoxId(this.beforePostForm.cashBoxId)\n        TokenService.setDepartmentId(this.beforePostForm.departmentId)\n        this.createSaleForm()\n        this.getItemsByDepId()\n        this.beforePostModal = false\n      }\n      this.checkZReport()\n    },\n    closeZcode() {\n      if (this.zCode == this.code) {\n        this.zForm.cashboxId = localStorage.getItem('cashboxId')\n        this.zForm.departmentId = localStorage.getItem('dep_id')\n        ZReportService.CreateZ_Report(this.zForm).then(res => {\n          this.checkedZetId = res.data.id\n          this.createSaleForm()\n          this.Zmodal = false\n        })\n      }\n    },\n    checkZReport() {\n      ZReportService.CheckZetReport(localStorage.getItem('dep_id'), localStorage.getItem('cashboxId')).then(res => {\n        this.checkedZetId = res.data.id\n        if(res.data.open) {\n          this.createSaleForm()\n          this.Zmodal = false\n        } else {\n          this.Zmodal = true\n        }\n      })\n    },\n    closeZReport() {\n      this.close_Z_Form.cashboxId = localStorage.getItem('cashboxId')\n      this.close_Z_Form.departmentId = localStorage.getItem('dep_id')\n      this.close_Z_Form.id = this.checkedZetId\n      ZReportService.CloseZReport(this.close_Z_Form).then(res => {\n        this.CloseZmodal = false\n        this.checkZReport()\n        this.BeforePost()\n      }).catch(e => {\n        this.$vs.notification({\n          title: this.$t('post.z_report_close_error'),\n          type:'confirm',\n          color: 'dangir',\n          position: 'top-center',\n          duration: 2000\n        })\n      })\n    },\n    save(status) {\n      if(this.paymentDtos !== []) {\n        if(this.paymentAmount !== '') {\n          this.saleform.status = status\n          this.saleform.whDocItems = null\n          let tmp = true\n          if(status === 'READY') {\n            if(this.saleform.whItems.length > 0) {\n              tmp = true\n            } else {\n              tmp = false\n              this.$vs.notification({\n                title: this.$t('item_required_error'),\n                progress: 'auto',\n                type:'confirm',\n                duration: 1000,\n                color: 'danger',\n                position: 'top-right'\n              })\n            }\n          }\n          if(tmp) {\n            this.saleform.cashboxId = localStorage.getItem('cashboxId')\n            this.saleform.zetReportId = this.checkedZetId\n            this.saleform.paymentDtos = this.paymentList.map(e => {\n              return {\n                paymentTypeId:e.id,\n                amount:e.amount,\n                name:e.name\n              }\n            }).filter(e => e.amount && e.amount>0 )\n            parseInt(this.saleform.whItems.salePrice)\n            this.saleform.fromDepartmentId = this.lol.id\n            this.saleform.fromDepartmentName = this.lol.name\n            SaleService.saveSale(this.saleform).then(res => {\n              this.payment = false\n              this.createSaleForm()\n              this.clear()\n              this.$vs.notification({\n                title: this.$t('success_updated'),\n                progress: 'auto',\n                type:'confirm',\n                duration: 1500,\n                color: 'success',\n                position: 'top-right'\n              })\n            })\n          } else {\n            this.getSaleSuspended()\n          }\n\n        } else {\n          this.$vs.notification({\n            title: this.$t('payment_error'),\n            progress: 'auto',\n            duration: 1000,\n            color: 'danger',\n            position: 'top-right'\n          })\n        }\n      } else {\n        this.$vs.notification({\n          title: this.$t('payment_error'),\n          progress: 'auto',\n          duration: 1000,\n          color: 'danger',\n          position: 'top-right'\n        })\n      }\n    },\n    /*saveSuspended(id) {\n      this.saleform.whDocItems = null\n      this.docId = id\n        this.saleform.status = 'READY'\n        SaleService.saveSale(this.saleform).then(res => {\n          this.payment = false\n          this.createSaleForm()\n          this.clear()\n          this.$vs.notification({\n            title: this.$t('success_updated'),\n            progress: 'auto',\n            duration: 1000,\n            color: 'success',\n            position: 'top-right'\n          })\n        })\n    },*/\n  },\n  beforeMount() {\n    this.BeforePost()\n  },\n  mounted() {\n    this.getCurrentUser();\n    this.getSaleSuspended();\n    this.GetDepartmentList()\n    this.getItemsByDepId()\n    this.checkZReport()\n  }\n}\n</script>\n\n<style scoped>\n.small {\n  font-size: 10px;\n  right: -180px;\n  top: -10px;\n}\n.desktop {\n  font-size: 10px;\n  right: -380px;\n  top: -12px;\n}\n</style>"]}]}